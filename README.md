# ðŸ  Floating Gateway (æµ®åŠ¨ç½‘å…³)

[![GitHub Release](https://img.shields.io/github/v/release/youruser/floatip)](../../releases)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

**Floating Gateway** æ˜¯ä¸€ä¸ªä¸ºå®¶åº­ç½‘ç»œè®¾è®¡çš„åŒè·¯ç”±å™¨é«˜å¯ç”¨æ–¹æ¡ˆã€‚å®ƒé€šè¿‡ **VRRP (è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®)** æŠ€æœ¯ï¼Œåœ¨ä½ çš„ä¸»è·¯ç”±ï¼ˆPrimaryï¼‰å’Œæ—è·¯ç”±ï¼ˆSecondaryï¼‰ä¹‹é—´å»ºç«‹ä¸€ä¸ª **VIP (è™šæ‹Ÿç½‘å…³ IP)**ã€‚

å½“ä½ çš„æ—è·¯ç”±ï¼ˆå‡ºå£ç½‘å…³ï¼‰å¥åº·æ—¶ï¼Œå®ƒæŒæœ‰ VIP å¹¶å¤„ç†æ‰€æœ‰æµé‡ï¼›ä¸€æ—¦æ£€æµ‹åˆ°æ—è·¯ç”±çš„å›½é™…é“¾è·¯æ•…éšœæˆ–å®•æœºï¼ŒVIP ä¼šè‡ªåŠ¨ç§’çº§æ¼‚ç§»åˆ°ä¸»è·¯ç”±ï¼Œç¡®ä¿ç½‘ç»œå§‹ç»ˆå¯ç”¨ã€‚

---

## ðŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **ðŸš€ è‡ªåŠ¨æ•…éšœåˆ‡æ¢**: æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ä»»ä½•è®¾å¤‡ç½‘å…³ï¼Œæ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢ï¼Œæ¢å¤æ—¶è‡ªåŠ¨æŠ¢å ã€‚
- **ðŸ” æ™ºèƒ½å¥åº·æ£€æµ‹**: å†…ç½® Pingã€DNSã€TCPã€HTTP å››ç§æ£€æµ‹ï¼Œæ”¯æŒ `basic`ï¼ˆè¿žé€šæ€§ï¼‰å’Œ `internet`ï¼ˆå›½é™…é“¾è·¯ï¼‰æ¨¡å¼ã€‚
- **ðŸ›¡ï¸ æžè‡´ç¨³å®šæ€§**: åŸºäºŽæˆç†Ÿçš„ Keepalived æ ¸å¿ƒï¼Œç»“åˆ Go è¯­è¨€ç¼–å†™çš„é˜²æŠ–ç­–ç•¥ï¼ˆk-of-n åˆ¤å®šï¼‰ã€‚
- **ðŸ–¥ï¸ å¯è§†åŒ–ç®¡ç†**: æä¾›è·¨å¹³å° Web æŽ§åˆ¶å°ï¼Œæ”¯æŒ Windowsã€macOSã€Linux ç”šè‡³ OpenWrtã€‚
- **ðŸ› ï¸ é›¶é…ç½®éƒ¨ç½²**: æ”¯æŒ Windows è‡ªåŠ¨å¼¹çª—ã€ä¸€é”®å®‰è£…/å¸è½½è„šæœ¬ã€SSH æ‰¹é‡éƒ¨ç½²ã€‚

---

## ðŸš€ å¿«é€Ÿå®‰è£… (æ–°æ‰‹æŽ¨è)

### 1. å‡†å¤‡å·¥ä½œ
- **ä¸¤å°è®¾å¤‡**: 
    - **Primary (A)**: é€šå¸¸æ˜¯ä½ çš„ä¸»è·¯ç”± (OpenWrt)ã€‚
    - **Secondary (B)**: ä½ çš„æ—è·¯ç”± (Ubuntu/Debian æˆ– OpenWrt)ã€‚
- **SSH æƒé™**: ç¡®ä¿ä¸¤å°è®¾å¤‡éƒ½å¼€å¯äº† SSH å¹¶å…è®¸ root ç™»å½•ã€‚

### 2. è¿è¡ŒæŽ§åˆ¶å° (Management Center)
æŽ§åˆ¶å°æ˜¯ä½ ç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„ä¸­å¿ƒï¼Œå»ºè®®è¿è¡Œåœ¨ä½ çš„å¸¸ç”¨ç”µè„‘æˆ– 7x24 å°æ—¶è¿è¡Œçš„æœåŠ¡å™¨ä¸Šã€‚

#### **Windows (æœ€ç®€å•)**
1. ä»Ž [Releases](../../releases) ä¸‹è½½ `gateway-controller-windows-amd64.exe`ã€‚
2. **ç›´æŽ¥åŒå‡»è¿è¡Œ**ã€‚
3. ç¨‹åºä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://localhost:8080`ã€‚

#### **Linux / macOS**
ä½¿ç”¨ä¸€é”®äº¤äº’è„šæœ¬ï¼š
```bash
# ä¸‹è½½è„šæœ¬
curl -O https://raw.githubusercontent.com/youruser/floatip/main/setup.sh
chmod +x setup.sh

# è¿è¡Œå¹¶é€‰æ‹© "1) [ç®¡ç†ç«¯] Gateway Controller"
./setup.sh
```

### 3. åœ¨ Web UI ä¸­éƒ¨ç½²
1. **æ·»åŠ èŠ‚ç‚¹**: åœ¨ç½‘é¡µä¸­å¡«å†™ A å’Œ B çš„ IPã€ç”¨æˆ·åã€å¯†ç ã€‚
2. **è®¾ç½® VIP**: å»ºè®®è®¾ç½®ä¸€ä¸ªæœªè¢«å ç”¨çš„ IPï¼ˆå¦‚ `192.168.1.254`ï¼‰ã€‚
3. **ç‚¹å‡» Install**: å‰©ä¸‹çš„äº‹æƒ…ï¼ˆå®‰è£…ä¾èµ–ã€åŒæ­¥é…ç½®ã€å¯åŠ¨æœåŠ¡ï¼‰äº¤ç»™ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ã€‚

---

## ðŸ› ï¸ è¿›é˜¶ï¼šæ‰‹åŠ¨å®‰è£… Agent

å¦‚æžœä½ ä¸æƒ³ä½¿ç”¨ Web UIï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åœ¨è·¯ç”±å™¨ä¸Šå®‰è£…ã€‚

### 1. ä½¿ç”¨äº¤äº’å¼è„šæœ¬ (æŽ¨è)
åœ¨ A å’Œ B è·¯ç”±å™¨ä¸Šåˆ†åˆ«è¿è¡Œï¼š
```bash
curl -O https://raw.githubusercontent.com/youruser/floatip/main/setup.sh
chmod +x setup.sh
./setup.sh
# é€‰æ‹© "2) [è·¯ç”±å™¨] Gateway Agent"
```
è„šæœ¬ä¼šå¼•å¯¼ä½ å®Œæˆè§’è‰²é€‰æ‹©ï¼ˆPrimary/Secondaryï¼‰å’Œç½‘ç»œé…ç½®ã€‚

### 2. å‘½ä»¤è¡Œéƒ¨ç½²
```bash
# ç”Ÿæˆé…ç½®æ–‡ä»¶ (ä»¥ Secondary ä¸ºä¾‹)
mkdir -p /etc/gateway-agent
cat > /etc/gateway-agent/config.yaml << EOF
version: 1
role: secondary
lan:
  iface: eth0
  vip: 192.168.1.254
routers:
  peer_ip: 192.168.1.1
health:
  mode: internet
EOF

# åº”ç”¨é…ç½®å¹¶å¯åŠ¨
gateway-agent apply
gateway-agent run
```

---

## ðŸ“Š éªŒè¯ä¸ŽæŽ’éšœ

### 1. å¦‚ä½•ç¡®è®¤éƒ¨ç½²æˆåŠŸï¼Ÿ
- **è§‚å¯Ÿ VIP**: åœ¨è·¯ç”±å™¨ä¸Šè¿è¡Œ `ip addr show`ï¼Œåº”èƒ½åœ¨ç½‘å¡ä¸Šçœ‹åˆ°ä½ è®¾ç½®çš„ VIPã€‚
- **æµ‹è¯•åˆ‡æ¢**: 
    1. åœ¨ç”µè„‘ä¸Šå°†ç½‘å…³è®¾ä¸º **VIP**ã€‚
    2. åœæ­¢ Secondary çš„æœåŠ¡ (`gateway-agent stop`)ã€‚
    3. è¿è¡Œ `ping 223.5.5.5`ï¼Œç¡®è®¤ç½‘ç»œåœ¨çŸ­æš‚æ³¢åŠ¨åŽæ¢å¤ã€‚

### 2. å¸¸è§é—®é¢˜ (FAQ)
- **Q: VIP æ— æ³•æ¼‚ç§»ï¼Ÿ**
  A: æ£€æŸ¥ä¸¤å°è·¯ç”±å™¨é˜²ç«å¢™æ˜¯å¦å…è®¸ VRRP åè®®ï¼ˆåè®®å· 112ï¼‰ã€‚
- **Q: ä¸ºä»€ä¹ˆçŠ¶æ€æ˜¾ç¤º Unhealthyï¼Ÿ**
  A: è¿è¡Œ `gateway-agent doctor` è¿›è¡Œè‡ªæ£€ï¼ŒæŸ¥çœ‹å…·ä½“çš„æ£€æµ‹å¤±è´¥åŽŸå› ã€‚
- **Q: å®¢æˆ·ç«¯éœ€è¦æ”¹è®¾ç½®å—ï¼Ÿ**
  A: éªŒè¯é€šè¿‡åŽï¼Œå°†ä½ ä¸»è·¯ç”± DHCP çš„â€œé»˜è®¤ç½‘å…³â€æ”¹ä¸º **VIP** å³å¯ã€‚

---

## ðŸ—ï¸ å¼€å‘è€…æŒ‡å—

### ç¼–è¯‘é¡¹ç›®
```bash
# äº¤å‰ç¼–è¯‘æ‰€æœ‰å¹³å°
./scripts/build.sh
```

### ç›®å½•ç»“æž„
- `cmd/`: å‘½ä»¤è¡Œå…¥å£ (Agent & Controller)
- `internal/`: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (å¥åº·æ£€æŸ¥ã€VRRP æ¨¡æ¿ã€å¹³å°é€‚é…)
- `scripts/`: å„å¹³å°å®‰è£…/å¸è½½/ç®¡ç†è„šæœ¬
- `examples/`: å…¸åž‹åœºæ™¯é…ç½®æ¨¡æ¿

---

## ðŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºã€‚

---
*å¦‚æžœæœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿Žæäº¤ Issue æˆ– Pull Requestï¼*
