# è‡ªåŠ¨å‘å¸ƒå’Œè‡ªåŠ¨å‡çº§ç³»ç»Ÿ

æœ¬æ–‡æ¡£è¯´æ˜ Floating Gateway çš„è‡ªåŠ¨å‘å¸ƒå’Œè‡ªåŠ¨å‡çº§åŠŸèƒ½çš„å·¥ä½œåŸç†ã€‚

## ğŸ“¦ è‡ªåŠ¨å‘å¸ƒå·¥ä½œæµ

### è§¦å‘æ¡ä»¶
å½“ä»£ç æ¨é€åˆ° `main` åˆ†æ”¯æ—¶ï¼Œè‡ªåŠ¨å‘å¸ƒå·¥ä½œæµä¼šè¢«è§¦å‘ï¼ˆé™¤éåªä¿®æ”¹äº†æ–‡æ¡£æ–‡ä»¶ï¼‰ã€‚

### ç‰ˆæœ¬å·ç­–ç•¥
å·¥ä½œæµä¼šæ ¹æ®æäº¤ä¿¡æ¯è‡ªåŠ¨å†³å®šç‰ˆæœ¬å·çš„å¢é•¿æ–¹å¼ï¼š

- **æ–°åŠŸèƒ½** (`feat`/`feature`/`æ–°åŠŸèƒ½`/`æ·»åŠ `): å¢åŠ  **minor** ç‰ˆæœ¬
  - ä¾‹å¦‚: v1.2.3 â†’ v1.3.0
  
- **é‡å¤§å˜æ›´** (`break`/`breaking`/`é‡å¤§å˜æ›´`): å¢åŠ  **major** ç‰ˆæœ¬
  - ä¾‹å¦‚: v1.2.3 â†’ v2.0.0
  
- **å…¶ä»–** (ä¿®å¤/ä¼˜åŒ–ç­‰): å¢åŠ  **patch** ç‰ˆæœ¬
  - ä¾‹å¦‚: v1.2.3 â†’ v1.2.4

### æ„å»ºäº§ç‰©
å·¥ä½œæµä¼šè‡ªåŠ¨æ„å»ºä»¥ä¸‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼š

#### Agentï¼ˆè·¯ç”±å™¨ç«¯ï¼‰
- `gateway-agent-linux-amd64` - Linux x86_64
- `gateway-agent-linux-arm64` - Linux ARM64
- `gateway-agent-linux-arm` - Linux ARM v7
- `gateway-agent-linux-mips` - OpenWrt MIPS
- `gateway-agent-linux-mipsle` - OpenWrt MIPS LE

#### Controllerï¼ˆç®¡ç†ç«¯ï¼‰
- `gateway-controller-linux-amd64` - Linux x86_64
- `gateway-controller-linux-arm64` - Linux ARM64
- `gateway-controller-darwin-amd64` - macOS Intel
- `gateway-controller-darwin-arm64` - macOS Apple Silicon
- `gateway-controller-windows-amd64.exe` - Windows 64ä½

#### æ ¡éªŒå’Œ
- `checksums.txt` - SHA256 æ ¡éªŒå’Œæ–‡ä»¶

### å‘å¸ƒæµç¨‹
1. æ£€æŸ¥æœ€æ–°çš„ Git æ ‡ç­¾
2. æ ¹æ®æäº¤ä¿¡æ¯è®¡ç®—æ–°ç‰ˆæœ¬å·
3. åˆ›å»ºå¹¶æ¨é€æ–°æ ‡ç­¾
4. æ„å»ºæ‰€æœ‰å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶
5. ç”Ÿæˆ Release Notes
6. åˆ›å»º GitHub Release å¹¶ä¸Šä¼ æ–‡ä»¶

## ğŸ”„ è‡ªåŠ¨å‡çº§åŠŸèƒ½

### Controller è‡ªåŠ¨å‡çº§

#### Web UI æ“ä½œ
1. ç‚¹å‡»"æ£€æŸ¥æ›´æ–°"æŒ‰é’®
2. å¦‚æœæœ‰æ–°ç‰ˆæœ¬ï¼Œä¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å’Œ"è‡ªåŠ¨å‡çº§"æŒ‰é’®
3. ç‚¹å‡»"è‡ªåŠ¨å‡çº§"æŒ‰é’®
4. ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½æ–°ç‰ˆæœ¬å¹¶é‡å¯æœåŠ¡

#### æŠ€æœ¯å®ç°
- **ç‰ˆæœ¬æ£€æŸ¥**: è°ƒç”¨ GitHub API è·å–æœ€æ–° Release ä¿¡æ¯
- **æ™ºèƒ½ä¸‹è½½**: ä¼˜å…ˆä½¿ç”¨ GitHub åŠ é€Ÿé•œåƒï¼ˆå›½å†…ç”¨æˆ·å‹å¥½ï¼‰
- **åŸåœ°å‡çº§**: ä¸‹è½½æ–°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¤‡ä»½æ—§æ–‡ä»¶ï¼Œæ›¿æ¢å¹¶é‡å¯
- **å®‰å…¨éªŒè¯**: éªŒè¯æ–‡ä»¶å¤§å°ç¡®ä¿ä¸‹è½½å®Œæ•´

### Agent è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬

#### å®‰è£…æ–¹å¼
æ‰€æœ‰å®‰è£…æ–¹å¼éƒ½ä¼šè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼š

1. **Web UI å®‰è£…**: ä½¿ç”¨ `releases/latest/download` URL
2. **setup.sh è„šæœ¬**: ä½¿ç”¨ `releases/latest/download` URL
3. **controller.sh è„šæœ¬**: è°ƒç”¨ GitHub API è·å–æœ€æ–°ç‰ˆæœ¬
4. **router.sh è„šæœ¬**: è°ƒç”¨ GitHub API è·å–æœ€æ–°ç‰ˆæœ¬

#### ä¸‹è½½åŠ é€Ÿ
æ‰€æœ‰ä¸‹è½½éƒ½æ”¯æŒ GitHub åŠ é€Ÿé•œåƒï¼š
- `https://xuc.xi-xu.me/`
- `https://gh-proxy.com/`
- `https://ghfast.top/`

ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•å¤šä¸ªé•œåƒæºï¼Œç¡®ä¿ä¸‹è½½æˆåŠŸã€‚

## ğŸ› ï¸ å¼€å‘è€…æŒ‡å—

### è§¦å‘æ–°ç‰ˆæœ¬å‘å¸ƒ
åªéœ€è¦æ¨é€ä»£ç åˆ° main åˆ†æ”¯ï¼Œå·¥ä½œæµä¼šè‡ªåŠ¨å¤„ç†ï¼š

```bash
# ä¿®å¤ bug
git commit -m "ä¿®å¤: ä¿®æ­£æŸä¸ªé—®é¢˜"
git push origin main
# å°†å‘å¸ƒ v1.2.4 (patch)

# æ·»åŠ æ–°åŠŸèƒ½
git commit -m "æ–°åŠŸèƒ½: æ·»åŠ æŸä¸ªåŠŸèƒ½"
git push origin main
# å°†å‘å¸ƒ v1.3.0 (minor)

# é‡å¤§å˜æ›´
git commit -m "é‡å¤§å˜æ›´: ä¸å…¼å®¹çš„ API ä¿®æ”¹"
git push origin main
# å°†å‘å¸ƒ v2.0.0 (major)
```

### ç‰ˆæœ¬å·æ³¨å…¥
æ„å»ºæ—¶é€šè¿‡ ldflags æ³¨å…¥ç‰ˆæœ¬å·ï¼š

```bash
go build -ldflags "-X github.com/zczy-k/FloatingGateway/internal/controller.Version=v1.2.3"
```

### æœ¬åœ°æµ‹è¯•
```bash
# æ„å»ºæ‰€æœ‰å¹³å°
./scripts/build.sh

# æµ‹è¯•ç‰ˆæœ¬æ£€æŸ¥ API
curl http://localhost:8080/api/version

# æµ‹è¯•å‡çº§ API
curl -X POST http://localhost:8080/api/upgrade \
  -H "Content-Type: application/json" \
  -d '{"version":"v1.2.3"}'
```

## ğŸ“‹ é…ç½®æ–‡ä»¶

### GitHub Actions å·¥ä½œæµ
- ä½ç½®: `.github/workflows/auto-release.yml`
- æƒé™: éœ€è¦ `contents: write` æƒé™æ¥åˆ›å»º Release

### API ç«¯ç‚¹
- `GET /api/version` - è·å–ç‰ˆæœ¬ä¿¡æ¯
- `POST /api/upgrade` - è§¦å‘è‡ªåŠ¨å‡çº§

## ğŸ” æ•…éšœæ’æŸ¥

### å·¥ä½œæµæœªè§¦å‘
- æ£€æŸ¥æ˜¯å¦åªä¿®æ”¹äº†æ–‡æ¡£æ–‡ä»¶ï¼ˆä¼šè¢«å¿½ç•¥ï¼‰
- æ£€æŸ¥ GitHub Actions æ˜¯å¦å¯ç”¨
- æŸ¥çœ‹ Actions æ ‡ç­¾é¡µçš„è¿è¡Œæ—¥å¿—

### å‡çº§å¤±è´¥
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æŸ¥çœ‹ Controller æ—¥å¿—
- å°è¯•æ‰‹åŠ¨ä¸‹è½½å¹¶æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶

### ç‰ˆæœ¬å·ä¸æ­£ç¡®
- æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼
- æŸ¥çœ‹ GitHub Actions æ—¥å¿—ä¸­çš„ç‰ˆæœ¬è®¡ç®—æ­¥éª¤
- æ‰‹åŠ¨åˆ›å»ºæ­£ç¡®çš„æ ‡ç­¾

## ğŸ¯ æœ€ä½³å®è·µ

1. **æäº¤ä¿¡æ¯è§„èŒƒ**: ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯å‰ç¼€ï¼ˆä¿®å¤/æ–°åŠŸèƒ½/é‡å¤§å˜æ›´ï¼‰
2. **æµ‹è¯•åå‘å¸ƒ**: åœ¨æœ¬åœ°å……åˆ†æµ‹è¯•åå†æ¨é€åˆ° main åˆ†æ”¯
3. **ç‰ˆæœ¬å›é€€**: å¦‚æœå‘å¸ƒæœ‰é—®é¢˜ï¼Œå¯ä»¥åˆ é™¤æ ‡ç­¾å¹¶é‡æ–°å‘å¸ƒ
4. **ç›‘æ§å‘å¸ƒ**: å…³æ³¨ GitHub Actions çš„è¿è¡ŒçŠ¶æ€
5. **ç”¨æˆ·é€šçŸ¥**: é‡å¤§æ›´æ–°æ—¶åœ¨ Release Notes ä¸­è¯¦ç»†è¯´æ˜

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/)
- [GitHub Releases API](https://docs.github.com/en/rest/releases)
